<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø§Ù„Ù…Ù†Ù‚Ø° Ø§Ù„Ø°ÙƒÙŠ â€” Ø¥Ø±Ø³Ø§Ù„ Ø·ÙˆØ§Ø±Ø¦</title>

<!-- PWA manifest -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#d93b3b">

<style>
  :root{
    --accent:#d93b3b;
    --muted:#666;
    --bg:#f7f7f8;
    --card:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:"Tajawal",system-ui,sans-serif;direction:rtl;
    background:linear-gradient(180deg,#f6fbff,#f7f7f8);color:#111;
    display:flex;align-items:center;justify-content:center;padding:18px;
  }
  .wrap{width:100%;max-width:920px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{margin:0;color:var(--accent);font-size:1.15rem}
  small{color:var(--muted)}
  .card{background:var(--card);border-radius:12px;padding:16px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 6px 20px rgba(18,38,63,0.04);margin-top:14px}
  label{display:block;margin:8px 0 6px;font-weight:700}
  input,textarea,select,button{font-size:1rem}
  input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e9;background:#fff}
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .btn{background:var(--accent);color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
  .btn.ghost{background:#fff;color:var(--accent);border:1px solid #f0dede}
  .btn.warn{background:#ff9800}
  .muted{color:var(--muted);font-size:0.9rem}
  table{width:100%;border-collapse:collapse;margin-top:10px;font-size:0.95rem}
  th,td{padding:8px;border-bottom:1px solid #f4f4f4;text-align:right}
  th{color:var(--accent);font-weight:800}
  .status{display:inline-block;padding:6px 10px;border-radius:8px;background:#f6f6f6;color:#333;font-size:0.9rem}
  @media(max-width:640px){.row{flex-direction:column}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ğŸš¨ Ø§Ù„Ù…Ù†Ù‚Ø° Ø§Ù„Ø°ÙƒÙŠ</h1>
        <small>Ø¥Ø±Ø³Ø§Ù„ Ø·ÙˆØ§Ø±Ø¦ Ø³Ø±ÙŠØ¹ â€” ÙˆØ§ØªØ³Ø§Ø¨ / SMS â€” ØªØ«Ø¨ÙŠØª ÙƒØªØ·Ø¨ÙŠÙ‚</small>
      </div>
      <div class="muted">PWA â€¢ Ù…Ø­Ù„ÙŠ â€¢ Ø¢Ù…Ù†</div>
    </header>

    <!-- ØªØ³Ø¬ÙŠÙ„ -->
    <div id="auth" class="card">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
      <input id="username" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§ (Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù„ÙŠ)"/>
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù…Ø­Ù„ÙŠ)</label>
      <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ØªØ­ÙØ¸ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø·"/>
      <div class="row" style="margin-top:10px">
        <button id="register" class="btn">Ø³Ø¬Ù‘Ù„</button>
        <button id="login" class="btn ghost">Ø¯Ø®ÙˆÙ„</button>
      </div>
      <p class="muted" style="margin-top:10px">Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ù„ÙŠ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø· â€” Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø§ ØªÙØ±Ø³Ù„ Ø¥Ù„Ù‰ Ø£ÙŠ Ø³ÙŠØ±ÙØ±.</p>
    </div>

    <!-- Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="panel" class="card" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong id="who">Ù…Ø±Ø­Ø¨Ù‹Ø§</strong>
          <div style="margin-top:6px"><span id="status" class="status">Ø¬Ø§Ù‡Ø²</span></div>
        </div>
        <div class="row">
          <button id="logout" class="btn ghost">Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>

      <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ -->
      <div style="margin-top:12px">
        <label>Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ø³ØªÙØ¶Ø§Ù Ø¥Ù„ÙŠÙ‡ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„)</label>
        <textarea id="emergencyText" placeholder="Ù…Ø«Ø§Ù„: Ø£Ù†Ø§ Ù…Ø­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙˆØ±Ù‹Ø§!"></textarea>
        <div class="muted" style="margin-top:6px">Ø³ÙŠØªÙ… Ø¥Ù„Ø­Ø§Ù‚ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©.</div>
      </div>

      <!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -->
      <div style="margin-top:12px">
        <label>Ø£Ø¶Ù Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯ (Ø¨Ø¯ÙˆÙ† +) â€” Ù…Ø«Ø§Ù„ Ø¯ÙˆÙ„ÙŠ: 201001234567</label>
        <div class="row">
          <input id="c_name" placeholder="Ø§Ù„Ø§Ø³Ù… (Ù…Ø«Ø§Ù„: Ø£Ù…Ù‘ÙŠ)"/>
          <input id="c_phone" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† +"/>
          <button id="addContact" class="btn">Ø£Ø¶Ù</button>
        </div>

        <table id="contactsTable" aria-live="polite">
          <thead><tr><th>Ø§Ø®ØªÙŠØ§Ø±</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø­Ø°Ù</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <button id="btnSOS" class="btn">ğŸ†˜ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù† â€” Ø§ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button id="btnCopy" class="btn ghost">Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
        <button id="btnSMS" class="btn ghost">ÙØªØ­ SMS (Ù†Ø³Ø®Ø©)</button>

        <!-- Ø²Ø± Ø®Ø§Øµ Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… -->
        <button id="btnSettings" class="btn ghost" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <div id="sendInfo" class="muted" style="margin-left:8px">Delay: <span id="delayMs">3000</span>ms</div>
      </div>

      <p class="muted" style="margin-top:10px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ±Ø³Ù„ Ø±Ø³Ø§Ø¦Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ â€” ÙŠØªÙ… ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø§Øª ÙˆØ§ØªØ³Ø§Ø¨/SMS Ù…Ø³Ø¨Ù‚Ø© Ø§Ù„Ù†Øµ Ù„ØªØ¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</p>
    </div>
  </div>

<script>
/* ====== PWA registration (optional) ====== */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js').catch(()=>{console.warn('SW reg failed')});
  });
}

/* ====== Helpers & storage ====== */
const qs = id => document.getElementById(id);
const norm = s => s ? s.replace(/\D/g,'') : '';
const USER_SESSION_KEY = 'rescuer_current_v1';
let sendDelay = 3000; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: 3 Ø«ÙˆØ§Ù†ÙŠ Ø¨ÙŠÙ† ÙØªØ­ ÙƒÙ„ Ù…Ø­Ø§Ø¯Ø«Ø©

/* ====== Auth (local) ====== */
qs('register').onclick = () => {
  const u = qs('username').value.trim(), p = qs('password').value;
  if(!u || !p) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
  if(localStorage.getItem('rescuer_'+u)) return alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
  localStorage.setItem('rescuer_'+u, JSON.stringify({password:p, contacts:[], emergencyText:''}));
  localStorage.setItem(USER_SESSION_KEY, u);
  startSession(u);
};
qs('login').onclick = () => {
  const u = qs('username').value.trim(), p = qs('password').value;
  const raw = localStorage.getItem('rescuer_'+u); if(!raw) return alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  const data = JSON.parse(raw); if(data.password !== p) return alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
  localStorage.setItem(USER_SESSION_KEY, u);
  startSession(u);
};
qs('logout').onclick = () => {
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
    localStorage.removeItem(USER_SESSION_KEY);
    endSession();
  }
};

function startSession(u){
  const raw = localStorage.getItem('rescuer_'+u);
  const data = raw ? JSON.parse(raw) : {password:'', contacts:[], emergencyText:''};
  qs('auth').style.display = 'none'; qs('panel').style.display = 'block';
  qs('who').innerText = `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${u}`;
  qs('emergencyText').value = data.emergencyText || '';
  renderContacts(data.contacts || []);
  updateStatus('Ø¬Ø§Ù‡Ø²');
}
function endSession(){
  qs('auth').style.display = 'block'; qs('panel').style.display = 'none';
  qs('username').value=''; qs('password').value=''; qs('emergencyText').value='';
  updateStatus('ØºÙŠØ± Ù…Ø³Ø¬Ù„');
}

/* load session */
window.addEventListener('load', ()=> {
  const cur = localStorage.getItem(USER_SESSION_KEY);
  if(cur) startSession(cur);
});

/* ====== Contacts CRUD ====== */
function getCurrentUserData(){ const u = localStorage.getItem(USER_SESSION_KEY); if(!u) return null; const raw = localStorage.getItem('rescuer_'+u); return raw?JSON.parse(raw):null; }
function saveCurrentUserData(data){ const u = localStorage.getItem(USER_SESSION_KEY); if(!u) return; localStorage.setItem('rescuer_'+u, JSON.stringify(data)); }

function addRow(contact){
  const tbody = qs('contactsTable').querySelector('tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `<td style="width:70px"><input type="checkbox" data-id="${contact.id}"></td>
                  <td>${escapeHtml(contact.name)}</td><td>${escapeHtml(contact.phone)}</td>
                  <td><button class="btn ghost" data-del="${contact.id}">Ø­Ø°Ù</button></td>`;
  tbody.appendChild(tr);
  tr.querySelector('button[data-del]').onclick = () => {
    if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…ØŸ')) return;
    tr.remove();
    const d = getCurrentUserData(); if(!d) return;
    d.contacts = (d.contacts||[]).filter(x => x.id !== contact.id);
    saveCurrentUserData(d);
  };
}

function renderContacts(list){
  const tbody = qs('contactsTable').querySelector('tbody'); tbody.innerHTML = '';
  (list||[]).forEach(c => addRow(c));
}

/* escape to avoid injection when inserting text nodes */
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }

qs('addContact').onclick = () => {
  const name = qs('c_name').value.trim();
  const phoneRaw = qs('c_phone').value.trim();
  const phone = norm(phoneRaw);
  if(!name || !phone) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… ÙˆØ±Ù‚Ù… ØµØ­ÙŠØ­');
  const id = Date.now().toString();
  const contact = { id, name, phone };
  const d = getCurrentUserData() || {password:'', contacts:[], emergencyText:''};
  d.contacts = d.contacts || []; d.contacts.push(contact);
  saveCurrentUserData(d);
  addRow(contact);
  qs('c_name').value=''; qs('c_phone').value='';
};

/* save emergency text */
qs('emergencyText').addEventListener('change', ()=> {
  const d = getCurrentUserData(); if(!d) return;
  d.emergencyText = qs('emergencyText').value; saveCurrentUserData(d);
});

/* ====== Status UI ====== */
function updateStatus(txt){ qs('status').innerText = txt; }

/* ====== Messaging utils ====== */
function getSelectedPhones(){
  const tbody = qs('contactsTable').querySelector('tbody');
  const checks = Array.from(tbody.querySelectorAll('input[type=checkbox]:checked'));
  const phones = checks.map(ch => ch.closest('tr').cells[2].innerText.trim()).filter(Boolean);
  if(phones.length === 0){
    const d = getCurrentUserData();
    if(d && d.contacts) return d.contacts.map(c => c.phone);
    return [];
  }
  return phones;
}

/* try to get geolocation once */
function getLocationOnce(timeout=8000){
  return new Promise((resolve,reject)=>{
    if(!navigator.geolocation) return reject(new Error('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹'));
    navigator.geolocation.getCurrentPosition(pos => resolve({lat:pos.coords.latitude, lon:pos.coords.longitude}),
      err => reject(err), {enableHighAccuracy:true, timeout});
  });
}

/* build message with link */
function buildMessage(baseMsg, lat, lon){
  if(lat != null && lon != null) {
    return `${baseMsg} Ù…ÙˆÙ‚Ø¹ÙŠ: https://www.google.com/maps?q=${lat.toFixed(6)},${lon.toFixed(6)}`;
  }
  return baseMsg + ' (Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­)';
}

/* open wa.me for many phones sequentially with delay and small status alerts */
function openWhatsAppsFor(phones, message, delayMs=3000){
  if(!phones || phones.length === 0) return;
  updateStatus(`ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø§Øª ÙˆØ§ØªØ³Ø§Ø¨ (${phones.length})...`);
  phones.forEach((phone, idx) => {
    setTimeout(() => {
      updateStatus(`ÙØªØ­ Ø±Ù‚Ù… ${idx+1} Ù…Ù† ${phones.length}...`);
      window.open(`https://wa.me/${encodeURIComponent(phone)}?text=${encodeURIComponent(message)}`, '_blank');
      // ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù„Ùˆ Ù…Ø´ Ø¹Ø§ÙŠØ² alert popup
      // alert(`ØªÙ… ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ø±Ù‚Ù… ${phone} (${idx+1}/${phones.length})`);
    }, idx * delayMs);
  });
  // Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ ÙØªØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§ØªØŒ Ù†Ø¬Ù‡Ø² SMS ÙƒÙ†Ø³Ø®Ø©
  setTimeout(()=> {
    try { window.open(`sms:?&body=${encodeURIComponent(message)}`, '_blank'); } catch(e){ console.warn('ÙØªØ­ SMS ÙØ´Ù„', e); }
    updateStatus('ØªÙ… Ø§Ù„ØªØ­Ø¶ÙŠØ± â€” Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª');
  }, phones.length * delayMs + 300);
}

/* ==== Buttons actions ==== */
qs('btnSOS').onclick = async () => {
  if(!localStorage.getItem(USER_SESSION_KEY)) return alert('Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
  updateStatus('Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹...');
  const base = qs('emergencyText').value.trim() || (getCurrentUserData() && getCurrentUserData().emergencyText) || 'Ø£Ù†Ø§ ÙÙŠ Ø®Ø·Ø±! Ø£Ø­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø©!';
  let lat=null, lon=null;
  try { const p = await getLocationOnce(8000); lat=p.lat; lon=p.lon; } catch(e){ console.warn('no loc', e); }
  const msg = buildMessage(base, lat, lon);
  const phones = getSelectedPhones();
  if(phones.length === 0) { alert('Ù„Ø§ Ø£Ø±Ù‚Ø§Ù… Ù…Ø³Ø¬Ù„Ø©'); updateStatus('Ø¬Ø§Ù‡Ø²'); return; }
  openWhatsAppsFor(phones, msg, sendDelay);
};

qs('btnCopy').onclick = async () => {
  const base = qs('emergencyText').value.trim() || (getCurrentUserData() && getCurrentUserData().emergencyText) || 'Ø£Ù†Ø§ ÙÙŠ Ø®Ø·Ø±!';
  let lat=null; let lon=null;
  try { const p = await getLocationOnce(5000); lat=p.lat; lon=p.lon; } catch(e){ console.warn('no loc', e); }
  const msg = buildMessage(base, lat, lon);
  try {
    await navigator.clipboard.writeText(msg);
    alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
  } catch(e) {
    const ta = document.createElement('textarea'); ta.value = msg; document.body.appendChild(ta); ta.select();
    try { document.execCommand('copy'); alert('ØªÙ… Ø§Ù„Ù†Ø³Ø® (fallback)'); } catch(err){ alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®'); }
    ta.remove();
  }
};

qs('btnSMS').onclick = async () => {
  if(!localStorage.getItem(USER_SESSION_KEY)) return alert('Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
  updateStatus('Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹...');
  let lat=null, lon=null;
  try { const p = await getLocationOnce(8000); lat=p.lat; lon=p.lon; } catch(e){ console.warn('no loc', e); }
  const base = qs('emergencyText').value.trim() || (getCurrentUserData() && getCurrentUserData().emergencyText) || 'Ø£Ù†Ø§ ÙÙŠ Ø®Ø·Ø±!';
  const msg = buildMessage(base, lat, lon);
  try { window.open(`sms:?&body=${encodeURIComponent(msg)}`, '_blank'); } catch(e){ alert('ØªØ¹Ø°Ø± ÙØªØ­ SMS'); }
  updateStatus('Ø¬Ø§Ù‡Ø²');
};

/* settings Ø²Ø±: ÙŠÙØªØ­ Ù…Ø±Ø¨Ø¹ ØµØºÙŠØ± Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© */
qs('btnSettings').onclick = () => {
  const val = prompt('Ø­Ø¯Ø¯ Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† ÙØªØ­ ÙƒÙ„ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© (Ù…Ø«Ø§Ù„: 3000) :', String(sendDelay));
  if(val === null) return;
  const n = parseInt(val);
  if(Number.isNaN(n) || n < 200) return alert('Ø§Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø±Ù‚Ù…ÙŠØ© Ø£ÙƒØ¨Ø± Ù…Ù† 200 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©');
  sendDelay = n;
  qs('delayMs').innerText = String(sendDelay);
  updateStatus(`ØªÙ… Ø¶Ø¨Ø· Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¥Ù„Ù‰ ${sendDelay} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©`);
};

/* helper: show a small confirmation when window/tab becomes visible (user returned) */
document.addEventListener('visibilitychange', () => {
  if(document.visibilityState === 'visible') {
    // could restore status
  }
});
</script>
</body>
</html>
